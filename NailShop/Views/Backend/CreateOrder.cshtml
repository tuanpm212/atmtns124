@{
    ViewBag.Title = "Create Order";
    Layout = "~/Views/Share/_Backend.cshtml";
}

<section class="vbox" ng-app="MyApp" ng-controller="MainController">
    <section class="scrollable padder">
        <div class="m-b-md">
            <h3 class="m-b-none">@Resources.CreateOrder.titleForm</h3>
            <hr />
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@Resources.CreateOrder.lblBillAddress</label>
                        <div class="col-sm-9">
                            @Html.TextBox("BillAddress", (string)ViewBag.BillAddress, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@Resources.Backend.lblCity</label>
                        <div class="col-sm-4">
                            @Html.TextBox("City", (string)ViewBag.City, new { @class = "form-control" })
                        </div>
                        <label class="col-sm-1 control-label">@Resources.Backend.lblState</label>
                        <div class="col-sm-4">
                            @Html.TextBox("State", (string)ViewBag.State, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@Resources.Backend.lblZipCode</label>
                        <div class="col-sm-9">
                            @Html.TextBox("ZipCode", (string)ViewBag.ZipCode, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@Resources.Backend.lblDescription</label>
                        <div class="col-sm-9">
                            @Html.TextArea("Description", (string)ViewBag.Description, new { @class = "form-control", rows = "5" })
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-3 col-sm-8">
                            <div class="checkbox">
                                <label>
                                    @{
                                        bool IsCheck = Convert.ToBoolean(ViewBag.IsTemplate);
                                        @Html.CheckBox("IsTemplate", IsCheck)<strong>@Resources.CreateOrder.lblOrdTemplate</strong>
                                    }
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-3 col-sm-3">
                            <a href="/backend/order" class="btn btn-primary">@Resources.CreateOrder.btnBack</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 text-right">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@Resources.CreateOrder.lblShipAddress</label>
                        <div class="col-sm-9">
                            @Html.TextBox("DeliveryAddress", (string)ViewBag.DeliveryAddress, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@Resources.Backend.lblCity</label>
                        <div class="col-sm-4">
                            @Html.TextBox("CityShip", (string)ViewBag.CityShip, new { @class = "form-control" })
                        </div>
                        <label class="col-sm-1 control-label">@Resources.Backend.lblState</label>
                        <div class="col-sm-4">
                            @Html.TextBox("StateShip", (string)ViewBag.StateShip, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">@Resources.Backend.lblZipCode</label>
                        <div class="col-sm-9">
                            @Html.TextBox("ZipCodeShip", (string)ViewBag.ZipCodeShip, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="form-group form-inline">
                        <div class="col-sm-12 text-right">
                            <p class="control-label">@Resources.CreateOrder.lblNo  @Html.Label((string)@ViewBag.InvoiceNo, new { id = "lblInvoiceNo" })</></p>
                            <p class="control-label">@Resources.CreateOrder.lblOrdDate  @Html.Label((string)@ViewBag.InvoiceDate, new { id = "lblInvoiceDate" })</p>
                            <p class="control-label">@Resources.CreateOrder.lblAmount $@Html.Label((string)@ViewBag.Amount, new { id = "lblAmount" })</p>
                            <p class="control-label">@Resources.CreateOrder.lblDiscount $@Html.Label((string)@ViewBag.DiscountAmount, new { id = "lblDiscountAmount" })</p>
                            <p class="control-label">@Resources.CreateOrder.lblTaxAmount $@Html.Label((string)@ViewBag.TaxAmount, new { id = "lblTaxAmount" })</p>
                            <p class="control-label">@Resources.CreateOrder.lblTotal $@Html.Label((string)@ViewBag.TotalAmount, new { id = "lblTotalAmount" })</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div ui-grid="gridOptions" ui-grid-pagination class="myGrid table" style="height: 372px;"></div>
    </section>
</section>
@section Styles {
    <link href="~/Contents/css/ui-grid.css" rel="stylesheet" />
    <link href="~/Contents/css/backend-ui-grid.css" rel="stylesheet" />
}
@section Scripts {
    <script src="~/Scripts/angular.js"></script>
    <script src="~/Scripts/ui-grid.js"></script>
    <script>
        $(document).ready(function(){
            $('[data-toggle="popover"]').popover();
        });
        var OrdID = @ViewBag.OrdID, myjson, isFristLoad=true;
        var app = angular.module('MyApp', ['ui.grid', 'ui.grid.pagination']);
        app.controller('MainController', ['$scope', '$http', 'uiGridConstants', function ($scope, $http, $apply, uiGridConstants) {
            $scope.gridOptions = {
                paginationPageSizes: [10, 20, 40],
                paginationPageSize: 10,
                columnDefs: [
                    { name: "ProdNo", displayName: "@Resources.CreateOrder.gridNo" },
                        { name: "ProductName", displayName: "@Resources.CreateOrder.gridName"},
                        { name: "Price", displayName: "@Resources.CreateOrder.gridPrice" },
                        { name: "Qty", displayName: "@Resources.CreateOrder.gridQty" },
                        { name: "Discount", displayName: "@Resources.CreateOrder.gridDiscount" },
                        { name: "Total", displayName: "@Resources.CreateOrder.gridTotal" },
                ],
            };

            $scope.getPagedDataAsync = function (pageSize, page, searchText) {
                if (pageSize == null) {
                    $scope.gridOptions.paginationPageSize = 10;
                    pageSize = 10;
                }
                if (page == null) {
                    $scope.gridOptions.paginationCurrentPage = 1;
                    page = 1;
                }
                if(isFristLoad)
                {
                    isFristLoad=false;
                    $http({
                        url: "/backend/GetOrdForBackend?id="+ OrdID,
                        method: "GET"
                    }).success(function (data, status, headers, config) {
                        myjson = JSON.parse(data);
                        $scope.gridOptions.data = myjson;
                        SumTotalAmount(myjson);
                    }).error(function (data, status, headers, config) {
                        alert(JSON.stringify(data));
                    });
                }
                else
                {
                    $scope.setPagingData(myjson, page, pageSize);
                }
            };

            $scope.getPagedDataAsync($scope.gridOptions.paginationCurrentPage, $scope.gridOptions.paginationPageSize);
        }]);

        function SumTotalAmount(json)
        {
            var Total=0, Discount=0, TaxAmount=0, Amount=0;
            for(var i=0; i<json.length; i++)
            {
                Amount+=json[i].Price*json[i].Qty;
            }
            Total=Amount+TaxAmount - Discount;
            $('#lblAmount').html(Amount);
            $('#lblDiscountAmount').html(Discount);
            $('#lblTaxAmount').html(TaxAmount);
            $('#lblTotalAmount').html(Total);
        }
        IsEdit();
        function IsEdit()
        {
            if('@ViewBag.IsEdit'=='False')
                $(btnSave).addClass('hide');
        }
    </script>
}
